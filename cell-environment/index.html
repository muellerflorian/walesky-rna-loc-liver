



<!DOCTYPE html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
        <meta name="description" content="Collection of post-processing scripts for images analyzed with FISH-quant,">
      
      
        <link rel="canonical" href="https://muellerflorian.github.io/walesky-rna-loc-liver/cell-environment/">
      
      
        <meta name="author" content="Florian MUELLER">
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="/img/icons8-eukaryotic-cells-filled-100.png">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-3.0.4">
    
    
      
        <title>Cell environment - Quantify RNA localization in liver</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/application.451f80e5.css">
      
        <link rel="stylesheet" href="../assets/stylesheets/application-palette.22915126.css">
      
      
        
        
        <meta name="theme-color" content="#3f51b5">
      
    
    
      <script src="../assets/javascripts/modernizr.1aa3b519.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../assets/fonts/material-icons.css">
    
    
  </head>
  
    
    
    <body dir="ltr" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448"
    viewBox="0 0 416 448" id="__github">
  <path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19-18.125
        8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19 18.125-8.5
        18.125 8.5 10.75 19 3.125 20.5zM320 304q0 10-3.125 20.5t-10.75
        19-18.125 8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19
        18.125-8.5 18.125 8.5 10.75 19 3.125 20.5zM360
        304q0-30-17.25-51t-46.75-21q-10.25 0-48.75 5.25-17.75 2.75-39.25
        2.75t-39.25-2.75q-38-5.25-48.75-5.25-29.5 0-46.75 21t-17.25 51q0 22 8
        38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0
        37.25-1.75t35-7.375 30.5-15 20.25-25.75 8-38.375zM416 260q0 51.75-15.25
        82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5-41.75
        1.125q-19.5 0-35.5-0.75t-36.875-3.125-38.125-7.5-34.25-12.875-30.25-20.25-21.5-28.75q-15.5-30.75-15.5-82.75
        0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25
        30.875q36.75-8.75 77.25-8.75 37 0 70 8 26.25-20.5
        46.75-30.25t47.25-9.75q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34
        99.5z" />
</svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="../#cell-environment" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="https://muellerflorian.github.io/walesky-rna-loc-liver/" title="Quantify RNA localization in liver" class="md-header-nav__button md-logo">
          
            <i class="md-icon">wb_sunny</i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            
              <span class="md-header-nav__topic">
                Quantify RNA localization in liver
              </span>
              <span class="md-header-nav__topic">
                Cell environment
              </span>
            
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          
            <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
            
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
          
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  


  <a href="https://github.com/muellerflorian/walesky-rna-loc-liver.git" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#__github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      GitHub
    </div>
  </a>

          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
        

  

<nav class="md-tabs md-tabs--active" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  <li class="md-tabs__item">
    
      <a href=".." title="Overview" class="md-tabs__link">
        Overview
      </a>
    
  </li>

      
        
      
        
      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../rna-detection/" title="General workflows" class="md-tabs__link">
          General workflows
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../expression-gradient/" title="Analysis workflows" class="md-tabs__link md-tabs__link--active">
          Analysis workflows
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../licence/" title="About" class="md-tabs__link">
          About
        </a>
      
    </li>
  

      
    </ul>
  </div>
</nav>
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="https://muellerflorian.github.io/walesky-rna-loc-liver/" title="Quantify RNA localization in liver" class="md-nav__button md-logo">
      
        <i class="md-icon">wb_sunny</i>
      
    </a>
    Quantify RNA localization in liver
  </label>
  
    <div class="md-nav__source">
      


  


  <a href="https://github.com/muellerflorian/walesky-rna-loc-liver.git" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#__github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      GitHub
    </div>
  </a>

    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href=".." title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../tools-imjoy/" title="ImJoy" class="md-nav__link">
      ImJoy
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../tools-jupyter/" title="Jupyter" class="md-nav__link">
      Jupyter
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4">
    
    <label class="md-nav__link" for="nav-4">
      General workflows
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        General workflows
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../rna-detection/" title="RNA detection with FQ" class="md-nav__link">
      RNA detection with FQ
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../imjoy-annotation/" title="Image annotation with ImJoy" class="md-nav__link">
      Image annotation with ImJoy
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5" checked>
    
    <label class="md-nav__link" for="nav-5">
      Analysis workflows
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        Analysis workflows
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../expression-gradient/" title="Expression gradient" class="md-nav__link">
      Expression gradient
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Cell environment
      </label>
    
    <a href="./" title="Cell environment" class="md-nav__link md-nav__link--active">
      Cell environment
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#summary-of-analysis-workflow" title="Summary of analysis workflow" class="md-nav__link">
    Summary of analysis workflow
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#required-tools" title="Required tools" class="md-nav__link">
    Required tools
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#fish-quant-for-rna-detection" title="FISH-quant for RNA detection" class="md-nav__link">
    FISH-quant for RNA detection
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#imjoy-plugins" title="ImJoy Plugins" class="md-nav__link">
    ImJoy Plugins
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#jupyter-notebook" title="Jupyter notebook" class="md-nav__link">
    Jupyter notebook
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#data" title="Data" class="md-nav__link">
    Data
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#data-organisation" title="Data organisation" class="md-nav__link">
    Data organisation
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#demo-data" title="Demo data" class="md-nav__link">
    Demo data
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#analysis-workflow" title="Analysis workflow" class="md-nav__link">
    Analysis workflow
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-rna-detection-with-fq" title="1. RNA detection with FQ" class="md-nav__link">
    1. RNA detection with FQ
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-annotation-of-cells" title="2. Annotation of cells" class="md-nav__link">
    2. Annotation of cells
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-calculate-density-profiles" title="3. Calculate density profiles" class="md-nav__link">
    3. Calculate density profiles
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-location-to-store-results" title="4. Location to store results" class="md-nav__link">
    4. Location to store results
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#analysis-in-imjoy" title="Analysis in ImJoy" class="md-nav__link">
    Analysis in ImJoy
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#with-jupyter-notebook" title="With Jupyter notebook" class="md-nav__link">
    With Jupyter notebook
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-generated-result-files" title="4. Generated result files" class="md-nav__link">
    4. Generated result files
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6" type="checkbox" id="nav-6">
    
    <label class="md-nav__link" for="nav-6">
      About
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-6">
        About
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../licence/" title="Licence" class="md-nav__link">
      Licence
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#summary-of-analysis-workflow" title="Summary of analysis workflow" class="md-nav__link">
    Summary of analysis workflow
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#required-tools" title="Required tools" class="md-nav__link">
    Required tools
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#fish-quant-for-rna-detection" title="FISH-quant for RNA detection" class="md-nav__link">
    FISH-quant for RNA detection
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#imjoy-plugins" title="ImJoy Plugins" class="md-nav__link">
    ImJoy Plugins
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#jupyter-notebook" title="Jupyter notebook" class="md-nav__link">
    Jupyter notebook
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#data" title="Data" class="md-nav__link">
    Data
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#data-organisation" title="Data organisation" class="md-nav__link">
    Data organisation
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#demo-data" title="Demo data" class="md-nav__link">
    Demo data
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#analysis-workflow" title="Analysis workflow" class="md-nav__link">
    Analysis workflow
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-rna-detection-with-fq" title="1. RNA detection with FQ" class="md-nav__link">
    1. RNA detection with FQ
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-annotation-of-cells" title="2. Annotation of cells" class="md-nav__link">
    2. Annotation of cells
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-calculate-density-profiles" title="3. Calculate density profiles" class="md-nav__link">
    3. Calculate density profiles
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-location-to-store-results" title="4. Location to store results" class="md-nav__link">
    4. Location to store results
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#analysis-in-imjoy" title="Analysis in ImJoy" class="md-nav__link">
    Analysis in ImJoy
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#with-jupyter-notebook" title="With Jupyter notebook" class="md-nav__link">
    With Jupyter notebook
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-generated-result-files" title="4. Generated result files" class="md-nav__link">
    4. Generated result files
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                <h1 id="cell-environment">Cell environment<a class="headerlink" href="#cell-environment" title="Permanent link">&para;</a></h1>
<p>In this workflow, expression levels are measured in equi-distant zones around user-defined regions, e.g. cells.</p>
<p>As input the workflow requires:</p>
<ul>
<li><strong>FISH-quant</strong>  results file: positions of RNAs.</li>
<li><strong>ImJoy</strong> annotation files: positions of cells.</li>
</ul>
<h2 id="summary-of-analysis-workflow">Summary of analysis workflow<a class="headerlink" href="#summary-of-analysis-workflow" title="Permanent link">&para;</a></h2>
<p>For each RNA, the distance to every regions is calculated and the RNA is assigned
to the closest region.</p>
<p>The user also defines the spacing of equi-distant zones around each region. 
For each region, the number of RNAs for each zone is computed. Additionally, 
the number of pixels in each zone, i.e. it's area is calculated. If required, this
can be used to normalized the RNA counts, i.e. to to correct for the large size of regions
that are are further away.</p>
<h2 id="required-tools">Required tools<a class="headerlink" href="#required-tools" title="Permanent link">&para;</a></h2>
<h3 id="fish-quant-for-rna-detection">FISH-quant for RNA detection<a class="headerlink" href="#fish-quant-for-rna-detection" title="Permanent link">&para;</a></h3>
<p>For more information, Please visit the dedicated section <a href="../rna-detection/"><strong>here</strong></a>.</p>
<h3 id="imjoy-plugins">ImJoy Plugins<a class="headerlink" href="#imjoy-plugins" title="Permanent link">&para;</a></h3>
<p>These plugins have to be installed only once, after installation they will be
available in the dedicated ImJoy workspace: <strong><code>liver-rna-loc</code></strong></p>
<p>When pressing on the links below, ImJoy will open in your browser (best in Chrome) and
you will be asked to confirm the installation with a dialog as shown below. 
After confirmation, the plugin and additional auxiliary plugins will be installed.</p>
<ul>
<li>
<p><code>ImageAnnotator</code>: annotate your images.
<a href="https://imjoy.io/#/app?w=liver-rna-loc&plugin=oeway/ImJoy-Plugins:ImageAnnotator&upgrade=1" target="_blank"><strong>Install from here.</strong></a></p>
</li>
<li>
<p><code>CellEnvironment</code>: calculate expression gradient. <a href="https://imjoy.io/#/app?w=liver-rna-loc&plugin=muellerflorian/walesky-rna-loc-liver:CellEnvironment@stable&upgrade=1" target="_blank"><strong>Install from here.</strong></a> Alternatively, you can also use the provided Jupyter notebook.</p>
</li>
</ul>
<p><img src="https://raw.githubusercontent.com/muellerflorian/walesky-rna-loc-liver/master/docs/img/cell_env.png" width="600px"></img></p>
<h3 id="jupyter-notebook">Jupyter notebook<a class="headerlink" href="#jupyter-notebook" title="Permanent link">&para;</a></h3>
<p>To perform the calculation of the expression gradients, we also provide a Jupyter notebook <code>cell_environment.ipynb</code>, which can be found on GitHub in the folder <a href="https://github.com/muellerflorian/walesky-rna-loc-liver/tree/master/notebooks"><code>notebooks</code></a>.</p>
<h2 id="data">Data<a class="headerlink" href="#data" title="Permanent link">&para;</a></h2>
<h3 id="data-organisation">Data organisation<a class="headerlink" href="#data-organisation" title="Permanent link">&para;</a></h3>
<p>This workflow permits batch-processing of a large number of files, but requires a strict data-organization</p>
<ol>
<li>Top folder called <code>acquisition</code>.</li>
<li>A subfolder for each experimental condition, i.e. <code>cond_1</code> for the example data.</li>
<li>Each sample (usually a field of view) is in a separate folder, e.g. named <code>sample_1</code>, <code>sample_2</code>, ... .Each sample folder can contain images of multiple channels.</li>
<li>FQ result files are in the same folder. A folder can contain <strong>multiple FQ results</strong> for different channels.</li>
<li>An annotation file with the outlines cells (ending with <code>annotation.json</code>). See below
    for more details.</li>
</ol>
<p>In the example below, a folder contains the annotations (<code>annotation.json</code>),
two different channels (<code>...green.tif</code>,  <code>...red.tif</code>, <code>...blue.tif</code> ), the FQ outline file (<code>...outline.txt</code>), the FQ results
for the red channels <code>...spots.txt</code>, and an annotation file (<code>annotation.json</code>).</p>
<p>Please note that you can have <strong>only one annotation file per sample folder</strong>. You
can create it by visualizing any of the channels, but the same annotations will be used
for each FQ results file in this folder.</p>
<div class="highlight"><pre><span></span>├─ data__cell_environment/
│  ├─ acquisition
│  │  ├─ cond_1
│  │  │  ├─ sample_1
│  │  │  │  ├─ sample_1_annotation.json
│  │  │  │  ├─ sample_1_red_spots.txt
│  │  │  │  ├─ sample_1_red_outline.txt
│  │  │  │  ├─ sample_1_green.tif
│  │  │  │  ├─ sample_1_red.tif
│  │  │  │  ├─ sample_1_blue.tif
│  │  │  ├─ sample_2
│  │  │  ├─ ...
│  │  ├─ cond_1
│  │  │  ├─ sample_1
│  │  │  ├─ ...
│  ├─ analysis
│  │  ├─ cond_1
│  │  │  ├─ sample_1
│  │  │  │  ├─ analysis__cell_env
│  │  │  │  │  ├─ sample_1_red_spots
│  │  │  │  │  │  ├─ histogram__PIX.csv
│  │  │  │  │  │  ├─ histogram__RNA.csv
│  │  │  │  │  │  ├─ histogram__RNA_norm.csv
│  │  │  │  │  │  ├─ per_region
│  │  │  │  │  │  │  ├─ hist__reg_0.png
│  │  │  │  │  │  │  ├─ ...
│  │  │  │  │  │  │  ├─ histogram__reg_0.csv
│  │  │  │  │  │  │  ├─ ...
│  │  ├─ ...
</pre></div>

<h3 id="demo-data">Demo data<a class="headerlink" href="#demo-data" title="Permanent link">&para;</a></h3>
<p>You can find already processed demo data
<a href="https://www.dropbox.com/s/9uwu8ea7119a1mq/data__cell_environment.zip?dl=0" target="_blank"><strong>here.</strong></a></p>
<p>The outline cells are macrophages, and have the label <code>Mac</code>.</p>
<p>TODO: upon publication, demo data will be moved to Zenodo.</p>
<h2 id="analysis-workflow">Analysis workflow<a class="headerlink" href="#analysis-workflow" title="Permanent link">&para;</a></h2>
<h3 id="1-rna-detection-with-fq">1. RNA detection with FQ<a class="headerlink" href="#1-rna-detection-with-fq" title="Permanent link">&para;</a></h3>
<p>For more details, please consult the dedicated section <a href="../rna-detection/"><strong>here</strong></a>.</p>
<h3 id="2-annotation-of-cells">2. Annotation of cells<a class="headerlink" href="#2-annotation-of-cells" title="Permanent link">&para;</a></h3>
<p>For this workflow, all cells that should be analyze have to be manually annotated in ImJoy with one annotation
type. We recommend naming this annotation <code>Cells</code>, but other names can be used as well (but you have
to update the default value in the analysis scripts as described below).</p>
<p>For more details, please consult the dedicated section <a href="../imjoy-annotation/"><strong>here</strong></a>.</p>
<h3 id="3-calculate-density-profiles">3. Calculate density profiles<a class="headerlink" href="#3-calculate-density-profiles" title="Permanent link">&para;</a></h3>
<p>You can run this analysis either with the dedicated ImJoy plugin or the provided Jupyter notebook.
In either case, you need to have a local installation of Python. For more information consult the 
dedicated section <a href="../tools-imjoy/"><strong>here</strong></a>.</p>
<h3 id="4-location-to-store-results">4. Location to store results<a class="headerlink" href="#4-location-to-store-results" title="Permanent link">&para;</a></h3>
<p>The results will be saved in a dedicated folder <code>analysis__cell_env</code>. Here, a dedicated folder 
for each spot detection result will be created and named with the name of the FQ results file. </p>
<p>Different options exist to define where this folder will be created:</p>
<ol>
<li>You can define an <strong>absolute path name</strong>. This path will be used to store the data. </li>
<li>You can define a <strong>replacement operation</strong> where parts of the path name of the results, will be
   replaced with another string. This is convenient when wanting to store the results in a different location than the raw data. Such a replacement operation is specified with a string where the <code>old_string</code> is separated by the <code>new_string</code> with a <code>&gt;&gt;</code>, e.g. the string <code>acquisition&gt;&gt;analysis</code> indicates that not a complete path is provided, but that a string in the provided data folder will be replaced. More specifically, the string <code>acquisition</code> will be replaced by <code>analysis</code>. </li>
</ol>
<h4 id="analysis-in-imjoy">Analysis in ImJoy<a class="headerlink" href="#analysis-in-imjoy" title="Permanent link">&para;</a></h4>
<p>If you use <strong>Imjoy</strong>, you need to install the <strong>Jupyter engine</strong>. 
The first installation might take a bit of time, since the necessary Python environments
on the plugin engine are created.</p>
<p>Once installed, you will see in the plugin sidebar, where you can launch the analysis:</p>
<p><img alt="cellEnv-plugin-dialog.png" src="../img/cellEnv-plugin-dialog.png" style="width:300px" /></p>
<ol>
<li>
<p>Paste the full name of the folder that should be processed. This folder will be recursively searched
    and each subfolder containing an annotation file will be processed. </p>
</li>
<li>
<p>If needed, change the analysis parameters (see Table below), and press on plugin name in blue to launch 
    the analysis,</p>
<table>
<thead>
<tr>
<th>Option</th>
<th>Type</th>
<th>Default</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>Path DATA</code></td>
<td>str</td>
<td></td>
<td>Full path to folder that should be scanned for annotation files.</td>
</tr>
<tr>
<td><code>PATH Save</code></td>
<td>str</td>
<td></td>
<td>Where results should be saved (see above).</td>
</tr>
<tr>
<td><code>Region label</code></td>
<td>str</td>
<td><code>Cells</code></td>
<td>Label of the annotated regions.</td>
</tr>
<tr>
<td><code>Annotation file</code></td>
<td>str</td>
<td><code>annotation.json</code></td>
<td>Name of the ImJoy annotation file.</td>
</tr>
<tr>
<td><code>Hist [min]</code></td>
<td>int</td>
<td>0</td>
<td>Minimum value of histogram to summarize enrichment (in pixel).</td>
</tr>
<tr>
<td><code>Hist [max]</code></td>
<td>int</td>
<td>300</td>
<td>Maximum value of histogram to summarize enrichment (in pixel).</td>
</tr>
<tr>
<td><code>Hist [bin]</code></td>
<td>int</td>
<td>50</td>
<td>Bin size (in pixel).</td>
</tr>
</tbody>
</table>
</li>
<li>
<p>The plugin will then analyse all sample folders containing an annotation file. 
   Progress can be monitored in the plugin log, accessible via the <code>i</code> next to the plugin name.</p>
</li>
</ol>
<p><strong>Progress is reported</strong> in the plugin log (accessible with the 'i' symbol
next to the plugin name) and the ImJoy progress bar.</p>
<h4 id="with-jupyter-notebook">With Jupyter notebook<a class="headerlink" href="#with-jupyter-notebook" title="Permanent link">&para;</a></h4>
<p>Once you have your conda environment installed as described in the Overview section,
you can open the Jupyter notebook (<code>cell_environment.ipynb</code>, which can be found on 
GitHub in the folder <code>notebooks</code>.</p>
<p>You have to execute the first cell to import the analysis package.</p>
<p>The second cell allows you to</p>
<ol>
<li>Define the folder containing your data.</li>
<li>Defining the parameters described above for the analysis. </li>
</ol>
<p>Executing the cell, will launch the analysis workflow as described above.</p>
<h3 id="4-generated-result-files">4. Generated result files<a class="headerlink" href="#4-generated-result-files" title="Permanent link">&para;</a></h3>
<p>The function will create a number of result files, which are stored in the
subfolder <code>analysis__cell_env</code>. For each FQ result file, a separate subfolder 
with name of this file is created. In this folder the different histograms are 
summarized:</p>
<ul>
<li>
<p><strong><code>histogram__PIX.csv</code></strong>. Contains PIXEL histograms for all regions, e.g. 
    number of pixels in the defined equi-distant zones around the regions. 
    These values are used for renormalization. First column is the center of histogram bin (in pixel).</p>
</li>
<li>
<p><strong><code>histogram__RNA.csv</code></strong>. Contains RNA counts per equi-distant zone for all regions.</p>
</li>
<li>
<p><strong><code>histogram__RNA_norm.csv</code></strong>. Contains renormalized RNA counts per equi-distant 
    zone for all regions.</p>
</li>
</ul>
<p>In this folder, results for <strong>each region</strong> are stored
Results files have the full name of the FQ file with the following prefixes</p>
<ul>
<li>
<p><strong><code>histogram__reg_i.csv</code></strong>, histograms for region <code>i</code>. 
    Contains the spatial expression gradient as a table:</p>
<ul>
<li>1st col: center of histogram bins (in pixel).</li>
<li>2nd col: RNA counts</li>
<li>3rd col: Pixel counts</li>
<li>4th col: Normalize counts.</li>
</ul>
</li>
<li>
<p><strong><code>histogram_summary__reg_i.png</code></strong>, summary image of for region <code>i</code>. First row shows
    smFISH image, mask of region, distance transform (distance from region). Second row 
    shows the raw histograms for RNAs and pixels, as well as the renormalized histogram. </p>
</li>
</ul>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../expression-gradient/" title="Expression gradient" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Expression gradient
              </span>
            </div>
          </a>
        
        
          <a href="../licence/" title="Licence" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Licence
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Copyright &copy; 2019 Florian MUELLER
          </div>
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
        
  <div class="md-footer-social">
    <link rel="stylesheet" href="../assets/fonts/font-awesome.css">
    
      <a href="https://github.com/muellerflorian" class="md-footer-social__link fa fa-github-alt"></a>
    
      <a href="https://www.linkedin.com/in/muellerflorian/" class="md-footer-social__link fa fa-linkedin"></a>
    
      <a href="https://scholar.google.fr/citations?user=WrEj9t4AAAAJ" class="md-footer-social__link fa fa-google"></a>
    
  </div>

      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/application.583bbe55.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:".."}})</script>
      
    
    
      
    
  </body>
</html>