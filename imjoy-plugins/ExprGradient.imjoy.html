<docs lang="markdown">
[TODO: write documentation for this plugin.]
</docs>

<config lang="json">
{
  "name": "ExprGradient",
  "type": "native-python",
  "version": "0.1.3",
  "description": "Calculate epxression gradient",
  "tags": ["stable","dev"],
  "ui": [
        "Name region 1: {id: 'reg1', type: 'string', placeholder: 'CV'}",
        "Name region 2: {id: 'reg2', type: 'string', placeholder: 'PL'}"
    ],
  "cover": "",
  "inputs": null,
  "outputs": null,
  "flags": [],
  "icon": "extension",
  "api_version": "0.1.5",
  "env": "conda create -n ExprGradient python=3.6",
  "requirements": {"stable":["pip: matplotlib scikit-image nested-lookup",
                             "pip: -U git+https://github.com/muellerflorian/FISHquant-Analyst@3e464e0"],
                     "dev": ["pip: matplotlib scikit-image nested-lookup",
                             "pip:  -U --editable /Volumes/PILON_HD2/fmueller/Documents/code/FISHquant-Analyst"]},
  "dependencies": []
}
</config>

<script lang="python">

import matplotlib as mpl
mpl.use('Agg')
import matplotlib.pyplot as plt

import asyncio
from imjoy import api
    
from fqa import expressionHeatmap

class ImJoyPlugin():
    def setup(self):
        api.log('initialized')

    async def run(self, ctx):

        # Ask for folder
        ret = await api.showFileDialog(type='directory')

        # Analyze distance map
        if ret:
            expressionHeatmap.folder_scan_process(folder_root = ret['path'],
                                               region_labels = (ctx.config.reg1,ctx.config.reg2),
                                               log_msg_callback=api.log,
                                               log_prog_callback=api.showProgress)


api.export(ImJoyPlugin())
</script>
