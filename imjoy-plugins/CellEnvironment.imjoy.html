<docs lang="markdown">
[TODO: write documentation for this plugin.]
</docs>

<config lang="json">
{
  "name": "CellEnvironment",
  "type": "native-python",
  "version": "0.1.0",
  "description": "Calculate expression levels around annotated regions.",
  "tags": ["stable","dev"],
  "ui": [
        "Region label: {id: 'reg_label', type: 'string', placeholder: 'Cells'}",
        "Annotation file: {id: 'annotation_file', type: 'string', placeholder: 'annotation.json'}",
        "Hist [min]: {id: 'hist_min', type: 'number', placeholder: 0}",
        "Hist [max]: {id: 'hist_max', type: 'number', placeholder: 300}",
        "Hist [bin_size]: {id: 'hist_bin_size', type: 'number', placeholder: 50}"
    ],
  "cover": "",
  "inputs": null,
  "outputs": null,
  "flags": [],
  "icon": "extension",
  "api_version": "0.1.7",
  "env": "conda create -n rna-loc-liver python=3.6",
  "permissions": [],
  "requirements": {"stable":["pip: matplotlib scikit-image numpy pandas",
                             "pip: -U git+https://github.com/muellerflorian/walesky-rna-loc-liver@5483191"],
                     "dev": ["pip: matplotlib scikit-image numpy",
                             "pip:  -U --editable D:\\Documents\\code\\GitHub\\projects\\walesky-rna-loc-liver"]},
  "dependencies": []
}
</config>

<script lang="python">
from imjoy import api

import asyncio
import sys

from fqa import cell_environment

if sys.platform == "darwin":
    import matplotlib
    matplotlib.use('PS')

class ImJoyPlugin():
    def setup(self):
        api.log('CellEnvironment plugin initialized')

    async def run(self, ctx):
        
        # Ask for folder
        ret = await api.showFileDialog(type='directory')
        
        # Process files
        cell_environment.process_folder(
            path_scan = ret['path'], 
            region_label = ctx.config.reg_label, 
            bin_prop = (ctx.config.hist_min,ctx.config.hist_max,ctx.config.hist_bin_size), 
            annotation_file = ctx.config.annotation_file, 
            log_msg_callback = api.showStatus, 
            log_prog_callback = api.showProgress)
        
api.export(ImJoyPlugin())
</script>
